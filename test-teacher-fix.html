<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Teacher Class Loading Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Teacher Class Loading Fix Test</h1>
    <p>This page tests the new filtering logic for teacher class assignments.</p>
    
    <div id="results"></div>
    
    <script>
        function logResult(type, title, content) {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
            document.getElementById('results').appendChild(div);
        }
        
        // Test the filtering logic with sample data
        function testFilteringLogic() {
            logResult('info', 'Testing Filtering Logic', 'Starting tests...');
            
            // Sample students data (like what comes from Firestore)
            const sampleStudents = [
                { id: '1', form: 'FORM 1', stream: '', firstname: 'John', surname: 'Doe' },
                { id: '2', form: 'FORM 1', stream: 'G', firstname: 'Jane', surname: 'Smith' },
                { id: '3', form: 'FORM 5', stream: '', firstname: 'Alice', surname: 'Johnson' },
                { id: '4', form: 'FORM 5', stream: 'SCIENCES', firstname: 'Bob', surname: 'Wilson' },
                { id: '5', form: 'FORM 6', stream: '', firstname: 'Charlie', surname: 'Brown' },
                { id: '6', form: 'LOWER 6', stream: 'ARTS', firstname: 'Diana', surname: 'Davis' },
                { id: '7', form: 'UPPER 6', stream: 'SCIENCES', firstname: 'Eve', surname: 'Miller' }
            ];
            
            // Test different teacher class assignments
            const teacherClassTests = [
                { teacherClasses: ['Form 1'], expectedStudents: ['John Doe', 'Jane Smith'] },
                { teacherClasses: ['Form 1 G'], expectedStudents: ['Jane Smith'] },
                { teacherClasses: ['Form 5'], expectedStudents: ['Alice Johnson', 'Bob Wilson'] },
                { teacherClasses: ['Form 5 Sciences'], expectedStudents: ['Bob Wilson'] },
                { teacherClasses: ['Lower 6 Arts'], expectedStudents: ['Diana Davis'] },
                { teacherClasses: ['Upper 6 Sciences'], expectedStudents: ['Eve Miller'] }
            ];
            
            // Filtering logic from our fix
            function filterStudents(allStudents, teacherClasses) {
                return allStudents.filter(student => {
                    if (!student.form) return false;
                    
                    const studentForm = student.form.trim();
                    const studentStream = (student.stream || '').trim();
                    const studentFullClass = `${studentForm}${studentStream ? ` ${studentStream}` : ''}`;
                    
                    return teacherClasses.some(teacherClass => {
                        const teacherClassTrimmed = teacherClass.trim();
                        
                        // 1. Exact match (case-insensitive)
                        if (studentFullClass.toLowerCase() === teacherClassTrimmed.toLowerCase()) {
                            return true;
                        }
                        
                        // 2. Form-only match
                        if (studentForm.toLowerCase() === teacherClassTrimmed.toLowerCase()) {
                            return true;
                        }
                        
                        // 3. Partial match for teacher class containing student form
                        if (teacherClassTrimmed.toLowerCase().includes(studentForm.toLowerCase())) {
                            return true;
                        }
                        
                        return false;
                    });
                });
            }
            
            // Run tests
            teacherClassTests.forEach((test, index) => {
                const filteredStudents = filterStudents(sampleStudents, test.teacherClasses);
                const actualStudents = filteredStudents.map(s => `${s.firstname} ${s.surname}`);
                const success = JSON.stringify(actualStudents.sort()) === JSON.stringify(test.expectedStudents.sort());
                
                logResult(
                    success ? 'success' : 'error', 
                    `Test ${index + 1}: ${test.teacherClasses.join(', ')}`,
                    `Expected: ${test.expectedStudents.join(', ')}\nActual: ${actualStudents.join(', ')}\nResult: ${success ? 'PASS' : 'FAIL'}`
                );
            });
            
            logResult('info', 'Test Summary', 'All filtering logic tests completed. Check results above.');
        }
        
        // Run tests when page loads
        window.onload = function() {
            testFilteringLogic();
        };
    </script>
</body>
</html>